<!doctype html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="resource/css/mainstyle.css">
</head>
<body>
<h1>YOU ENTER MY SERVER!</h1>
<form>
    To See
    <input type="text" id="hrefff">
    <button type="button" onclick="changeStyle()">DANCE</button>
    <button type="button" onclick="activedShowing()">GO</button>
</form>
<div id="ajaxxx">
</div>
</body>
<script>
    //  用ajax返回文本数据并包装。
    var activedShowing = (function(){
        var xajax,
            textDiv,
            input;
        xajax   = new XMLHttpRequest();
        textDiv = document.getElementById("ajaxxx");
        input   = document.getElementById("hrefff");
        xajax.onreadystatechange = function(){
            console.log(this.readyState+"  "+this.status+"   "+this.statusText);
            var loadingflag = false;
            if (this.readyState == 4 && this.status == 200) {
                var arrText = xajax.responseText.split("\n");
                var arrText2 = arrText.map(fmtTxt);
                textDiv.innerHTML = arrText2.join("");
                console.log("Sucessed");
            }
            else if(this.status == 404){
                textDiv.innerHTML = "也没有吧就";
            }
            else if(this.status == 403){
                //  现在大概不会出现
                textDiv.innerHTML = "不给你看吧就";
            }
            else if(!loadingflag){
                textDiv.innerHTML = "等等不会？";
                loadingflag = true;
            }
        }
        console.log("initial aS");
        return function(){
            var numHref = input.value;
            textDiv.innerHTML = "";
            if(isNaN(numHref) || numHref < 1 || numHref > 7 || numHref === "")
                input.value = "Not Good";
            else{
                var addr = "/blog/"+numHref+".txt"
                xajax.open("GET",addr,true);
                xajax.send();
                //textDiv.innerHTML = xajax.responseText;
                //  这个返回也太丑了，，，，
                //textDic.innerHTML = formatText(responseText);
                //var arrText = xajax.responseText.split("\n");
                //var arrText2 = arrText.map(fmtTxt);
                //textDic.innerHTML = arrText2.join("");
            }
        }
    })();
    function fmtTxt(value,index){
        if(index==0)
            return "<h2>"+value+"</h2>";
        else
            return "<p>"+value+"</p>";
    }
</script>
<script>
    //  让字和背景流畅的变色（有啥用？）
    var changeStyle = (function(){
        var bStyle = document.getElementsByTagName("body").style;
        var x = 0,
            y = 0,
            z = 0;
        var switcher = false;
        function turnS(){
            if(switcher)
                switcher = false;
            else
                switcher = true;
        }
        function rgbccc(){
            //  设定颜色如何变化
            x = x + 1;
            y = y + 2;
            z = z + 3;
            //  回归
            if(x > 255)
                x = x % 256;
            if(y > 255)
                y = y % 256;
            if(z > 255)
                z = z % 256;
            bStyle.color            = "rgb("+x+","+y+","+z+")"
            bStyle.backgroundcolor  = "rgb("+(255-x)+","+(255-y)+","+(255-z)+")"
        }
        function reset(){
            bStyle.color            = "#404";
            bStyle.backgroundcolor  = "#afa";
            clearInterval();
        }
        console.log("initial cS");
        return function(){
            turnS();
            if(switcher)
                setInterval(rgbccc,5);
            else
                reset();
        }
    })();
</script>
</html>