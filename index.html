<!doctype html>
<html>
<head>
    <!--link rel="stylesheet" type="text/css" href="resource/css/mainstyle.css"-->
</head>
<body>
<h1>YOU ENTER MY SERVER!</h1>
<form>
    To See
    <input type="text" id="hrefff">
    <button type="button" onclick="changeStyle()">DANCE</button>
    <button type="button" onclick="activedShowing()">GO</button>
</form>
<div id="ajaxxx">
</div>
</body>
<script>
    //  用ajax返回文本数据并包装。
    var activedShowing = (function(){
        var xajax,
            textDiv,
            input;
        xajax   = new XMLHttpRequest();
        textDiv = document.getElementById("ajaxxx");
        input   = document.getElementById("hrefff");
        xajax.onreadystatechange = function(){
            console.log(this.readyState+"  "+this.status+"   "+this.statusText);
            var loadingflag = false;
            if (this.readyState == 4 && this.status == 200) {
                var arrText = xajax.responseText.split("\n");
                var arrText2 = arrText.map(fmtTxt);
                textDiv.innerHTML = arrText2.join("");
                console.log("Sucessed");
            }
            else if(this.status == 404){
                textDiv.innerHTML = "也没有吧就";
            }
            else if(this.status == 403){
                //  现在大概不会出现
                textDiv.innerHTML = "不给你看吧就";
            }
            else if(!loadingflag){
                textDiv.innerHTML = "等等不会？";
                loadingflag = true;
            }
        }
        console.log("initial aS");
        return function(){
            var numHref = input.value;
            textDiv.innerHTML = "";
            if(isNaN(numHref) || numHref < 1 || numHref > 7 || numHref === "")
                input.value = "Not Good";
            else{
                var addr = "/blog/"+numHref+".txt"
                xajax.open("GET",addr,true);
                xajax.send();
                //textDiv.innerHTML = xajax.responseText;
                //  这个返回也太丑了，，，，
                //textDic.innerHTML = formatText(responseText);
                //var arrText = xajax.responseText.split("\n");
                //var arrText2 = arrText.map(fmtTxt);
                //textDic.innerHTML = arrText2.join("");
            }
        }
    })();
    function fmtTxt(value,index){
        if(index==0)
            return "<h2>"+value+"</h2>";
        else
            return "<p>"+value+"</p>";
    }
</script>
<script>
    //  让字和背景流畅的变色（有啥用？）
    var changeStyle = (function(){
        var bStyle = document.body.style;
        var switcher = false;
        var ci=0;
        //  [变化方向,值,趋势]
        var color=[[true,0,7],[true,0,5],[true,0,4]];
        function setrgb(c){
            color.forEach(function(v,i,a){
                a[i][3]=c[i];
            })
        }
        function changergb(val,ind,arr){
            var f=val[0];
            var v=val[1];
            var c=val[2];
            if(f){
                if(v+c>255){
                    v=510-v-c;
                    f=!f;
                }
                else v=v+c;
            }
            else{
                if(v-c<0){
                    v=c-v;
                    f=!f;
                }
                else v=v-c;
            }
            arr[ind]=[f,v,c];
        }
        function turnS(){
            if(switcher)
                switcher = false;
            else
                switcher = true;
        }
        function runrgb(){
            //  一次变化 一次更新
            var x,y,z;
            color.forEach(changergb);
            x=color[0][2];
            y=color[1][2];
            z=color[2][2];
            bStyle.color            = "rgb("+x+","+y+","+z+")"
            bStyle.backgroundColor  = "rgb("+(x^255)+","+(y^255)+","+(z^255)+")"
        }
        console.log("initial cS");
        return function(){
            turnS();
            if(switcher)
                ci = setInterval(runrgb,5);
            else
                clearInterval(ci);
        }
    })();
</script>
<script>
    //  自动滚动的DIV
</script>
</html>